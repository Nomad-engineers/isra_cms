# Обзор электронной коммерции

![npm version](https://img.shields.io/npm/v/@payloadcms/plugin-ecommerce)

> **Важно:** Этот плагин в настоящее время находится в бета-версии и может иметь критические изменения в будущих релизах.

Payload предоставляет плагин электронной коммерции, который позволяет добавить функциональность электронной коммерции в ваше приложение. Он поставляется с набором утилит и коллекций для управления продуктами, заказами и платежами. Он также интегрируется с популярными платежными шлюзами, такими как Stripe, для обработки транзакций.

Этот плагин полностью открытый, и его [исходный код можно найти здесь](https://github.com/payloadcms/payload/tree/main/packages/plugin-ecommerce). Если вам нужна помощь, ознакомьтесь с нашей [Помощью сообщества](https://payloadcms.com/community-help). Если вы считаете, что нашли ошибку, пожалуйста, [создайте новый issue](https://github.com/payloadcms/payload/issues/new?assignees=&labels=plugin%3A%redirects&template=bug_report.md&title=plugin-ecommerce%3A) с максимально возможными подробностями.

## Основные функции

Плагин поставляется с широким набором функций, чтобы помочь вам начать работу с электронной коммерцией:

- Поддержка продуктов с вариантами по умолчанию
- Корзины отслеживаются в Payload
- Заказы и транзакции
- Адреса, связанные с вашими клиентами
- Паттерн адаптера платежей для создания собственных интеграций (в настоящее время поддерживается Stripe)
- Поддержка нескольких валют
- Утилиты React UI для помощи в управлении логикой вашего фронтенда

В настоящее время плагин не обрабатывает доставку, налоги или подписки изначально, но вы можете реализовать эти функции самостоятельно, используя предоставленные коллекции и хуки.

## Установка

Установите плагин с помощью любого менеджера пакетов JavaScript, такого как [pnpm](https://pnpm.io/), [npm](https://npmjs.com/) или [Yarn](https://yarnpkg.com/):

```bash
pnpm add @payloadcms/plugin-ecommerce
```

## Базовое использование

В массиве `plugins` вашей [Payload Config](https://payloadcms.com/docs/configuration/overview) вызовите плагин с:

```typescript
import { buildConfig } from 'payload'
import { ecommercePlugin } from '@payloadcms/plugin-ecommerce'

const config = buildConfig({
  collections: [
    {
      slug: 'pages',
      fields: [],
    },
  ],
  plugins: [
    ecommercePlugin({
      // Вы должны добавить здесь свои функции контроля доступа
      access: {
        adminOnly,
        adminOnlyFieldAccess,
        adminOrCustomerOwner,
        adminOrPublishedStatus,
        customerOnlyFieldAccess,
      },
      customers: {
        slug: 'users'
      },
    })
  ],
})

export default config
```

## Концепции

Важно понять, как работает плагин в целом и отношения между различными коллекциями.

### Клиенты (Customers)

Могут быть любой коллекцией пользователей в вашем приложении. Затем вы можете ограничить контроль доступа только для клиентов в зависимости от отдельных полей, таких как роли в коллекции клиентов, или по slug коллекции, если вы решили хранить их отдельно. Клиенты связаны с корзинами и заказами.

### Продукты и варианты (Products and Variants)

Продукты - это товары, которые вы продаете, и они будут содержать цену и, опционально, варианты через join поле, а также разрешенные типы вариантов.

Каждый тип варианта может содержать набор опций варианта. Например, продукт футболки может иметь тип варианта "Размер" с опциями "Маленький", "Средний" и "Большой", и каждый вариант может иметь эти опции, назначенные ему.

### Корзины (Carts)

Корзины связаны с клиентами или полностью публичны для гостевых пользователей и могут содержать несколько продуктов и вариантов. Корзины хранятся в базе данных и могут быть получены в любое время. Корзины автоматически создаются для клиентов, когда они впервые добавляют товар в свою корзину.

### Транзакции и заказы (Transactions and Orders)

Транзакции создаются при инициации платежа. Они содержат статус платежа и связаны с корзиной и клиентом. Заказы создаются, когда транзакция успешна, и содержат финальные детали покупки, включая товары, итоговую сумму и информацию о клиенте.

### Адреса (Addresses)

Адреса связаны с клиентами и могут использоваться для биллинговой и shipping информации. Они могут быть использованы повторно в нескольких заказах.

### Платежи (Payments)

Плагин использует паттерн адаптера, чтобы разрешить разные платежные шлюзы. Адаптер по умолчанию предназначен для Stripe, но вы можете создать свой собственный, реализовав интерфейс `PaymentAdapter`.

### Валюты (Currencies)

Плагин поддерживает использование нескольких валют на уровне конфигурации. Каждая валюта создаст отдельное ценовое поле в коллекциях Product и Variants.

Пакет также может использоваться частично, если вы хотите использовать только определенные его части, такие как только создание продуктов и вариантов. См. [Продвинутые использования и примеры](https://payloadcms.com/docs/ecommerce/advanced) для получения дополнительной информации.

## TypeScript

Плагин унаследует типы от ваших сгенерированных типов Payload там, где это возможно. Мы также экспортируем следующие типы:

- **Cart** - Тип корзины, хранящийся в состоянии React и локальном хранилище на стороне клиента.
- **CollectionOverride** - Тип для переопределения коллекций.
- **CurrenciesConfig** - Тип для конфигурации валют.
- **EcommercePluginConfig** - Объект конфигурации для плагина электронной коммерции.
- **FieldsOverride** - Тип для переопределения полей в коллекциях.

Все типы могут быть импортированы напрямую:

```typescript
import { EcommercePluginConfig } from '@payloadcms/plugin-ecommerce/types'
```

## Шаблон

[Директория шаблонов](https://github.com/payloadcms/payload/tree/main/templates) также содержит официальный [Шаблон электронной коммерции](https://github.com/payloadcms/payload/tree/main/templates/ecommerce), который использует этот плагин.

## Следующие шаги

### Плагин электронной коммерции

Подробное руководство по настройке и использованию плагина электронной коммерции.